================================================================================
ボイスメッセージ送受信アプリ
プロジェクト構成と実装ロードマップ
================================================================================

更新日: 2026年2月3日
プロジェクト根: /home/xiaox/voice-message-app


================================================================================
1. 現在のファイル構成
================================================================================

voice-message-app/
├── README.md                          # プロジェクト概要と実装機能説明
├── backend/                            # Node.js Expressバックエンド
│   ├── app.js                         # メインサーバーファイル
│   │   ├── ファイルアップロード機能（POST /upload）
│   │   ├── ファイル一覧取得API（GET /voices）
│   │   └── ファイルダウンロードAPI（GET /voice/:filename）
│   ├── package.json                   # NPM設定（Express, Multer）
│   └── uploads/                       # 音声ファイル保存ディレクトリ
│
└── voice_message_app/                 # Flutterモバイルアプリ
    ├── pubspec.yaml                   # Flutter依存パッケージ
    │   ├── record: ^5.1.2            # 音声録音
    │   ├── audioplayers: ^6.1.0      # 音声再生
    │   ├── permission_handler: ^11.3.1 # 権限管理
    │   ├── http: ^1.2.1              # HTTP通信
    │   ├── path_provider: ^2.1.3     # ファイルパス取得
    │   └── image_picker: ^0.8.7+2    # 画像選択
    │
    ├── lib/                           # アプリケーションコード
    │   ├── main.dart                  # アプリエントリーポイント
    │   │   ├── MyApp: メインウィジェット
    │   │   └── テーマ設定（deepPurple）
    │   │
    │   ├── constants.dart             # 定数定義
    │   │
    │   ├── screens/                   # UI画面
    │   │   ├── home_page.dart        # ホーム画面（タブナビゲーション）
    │   │   │   ├── ボイスメッセージタブ
    │   │   │   ├── フォロワータブ
    │   │   │   ├── 受信ファイルタブ
    │   │   │   └── サーバーから音声一覧取得機能
    │   │   │
    │   │   ├── recording_screen.dart # 録音画面
    │   │   │   ├── 音声録音UI
    │   │   │   ├── 複数フォロワー選択
    │   │   │   ├── 画像添付機能
    │   │   │   └── ファイル送信機能
    │   │   │
    │   │   ├── select_follower_screen.dart # フォロワー選択画面
    │   │   │   └── 複数フォロワー選択UI
    │   │   │
    │   │   ├── followers_tab.dart   # フォロワー一覧タブ
    │   │   │   ├── フォロワーリスト表示
    │   │   │   ├── フォロワー詳細情報表示
    │   │   │   └── メッセージ送信起点
    │   │   │
    │   │   ├── received_files_tab.dart # 受信メッセージタブ
    │   │   │   ├── 受信メッセージ一覧
    │   │   │   ├── 送信者情報表示
    │   │   │   ├── 受信日時表示
    │   │   │   └── 再生機能へのリンク
    │   │   │
    │   │   ├── voice_playback_screen.dart # 音声再生画面
    │   │   │   ├── 音声再生コントロール
    │   │   │   ├── 再生時間表示
    │   │   │   └── メッセージ情報表示
    │   │   │
    │   │   └── profile_page.dart    # プロフィール画面
    │   │       ├── ユーザー情報表示
    │   │       └── アプリ情報表示
    │   │
    │   └── services/                 # ビジネスロジック層
    │       ├── audio_service.dart    # 音声録音・再生管理
    │       │   ├── startRecording()   # 録音開始
    │       │   ├── stopRecording()    # 録音停止
    │       │   ├── playAudio()        # 音声再生
    │       │   ├── pausePlayback()    # 再生一時停止
    │       │   └── dispose()          # リソース解放
    │       │
    │       └── api_service.dart      # サーバー通信管理
    │           ├── uploadVoice()      # 音声ファイルアップロード
    │           ├── fetchVoices()      # 音声一覧取得
    │           ├── downloadVoice()    # 音声ダウンロード
    │           └── sendToFollowers()  # フォロワーへ送信
    │
    ├── test/                         # テストコード
    │   └── widget_test.dart          # ウィジェットテスト
    │
    ├── android/                      # Android設定ファイル
    ├── ios/                          # iOS設定ファイル
    ├── linux/                        # Linux設定ファイル
    ├── macos/                        # macOS設定ファイル
    ├── web/                          # Web設定ファイル
    └── windows/                      # Windows設定ファイル


================================================================================
2. 現在実装されている機能
================================================================================

【フロントエンド：Flutter】
✅ 基本的なUIフレームワーク（タブナビゲーション）
✅ 音声録音機能（マイク権限管理含む）
✅ 音声再生機能
✅ フォロワー一覧表示
✅ 受信メッセージ一覧表示
✅ メッセージ送信UI
✅ プロフィール画面
✅ 画像選択機能
✅ リアルタイム再生時間表示

【バックエンド：Node.js Express】
✅ ファイルアップロードAPI（POST /upload）
✅ ファイル一覧取得API（GET /voices）
✅ ファイルダウンロードAPI（GET /voice/:filename）
✅ Multerを使用したファイル管理
✅ 基本的なエラーハンドリング


================================================================================
3. 今後の実装予定内容
================================================================================

【フェーズ1：データベース連携（優先度：高）】
┌─────────────────────────────────────────────────────────────────
├── 3.1 ユーザー認証機能
│   ├── ユーザー登録API
│   ├── ログイン機能
│   ├── JWTトークン認証
│   ├── パスワード暗号化
│   └── セッション管理
│
├── 3.2 データベース設計・実装
│   ├── MongoDBまたはPostgreSQL導入
│   ├── ユーザーテーブル
│   │   ├── user_id（主キー）
│   │   ├── username
│   │   ├── email
│   │   ├── password_hash
│   │   ├── profile_image
│   │   ├── bio
│   │   └── created_at
│   │
│   ├── フォロワー関係テーブル
│   │   ├── follower_id（主キー）
│   │   ├── user_id
│   │   ├── follower_user_id
│   │   └── follow_date
│   │
│   ├── メッセージテーブル
│   │   ├── message_id（主キー）
│   │   ├── sender_id
│   │   ├── receiver_id
│   │   ├── file_path
│   │   ├── file_size
│   │   ├── duration
│   │   ├── sent_at
│   │   ├── read_at
│   │   └── transcript（音声テキスト化用）
│   │
│   └── ファイルメタデータテーブル
│       ├── file_id（主キー）
│       ├── original_filename
│       ├── stored_filename
│       ├── file_size
│       ├── mime_type
│       ├── upload_user_id
│       └── uploaded_at
│
├── 3.3 フロントエンド：認証画面の実装
│   ├── ログイン画面
│   ├── 登録画面
│   ├── パスワードリセット画面
│   └── 認証状態の管理（Provider/Riverpod）
│
└── 3.4 バックエンド：認証APIの実装
    ├── /auth/register - ユーザー登録
    ├── /auth/login - ログイン
    ├── /auth/refresh - トークンリフレッシュ
    └── /auth/logout - ログアウト

【フェーズ2：フォロワー機能強化（優先度：高）】
┌─────────────────────────────────────────────────────────────────
├── 4.1 ユーザー検索機能
│   ├── ユーザー検索API（GET /users/search）
│   ├── フロントエンド検索UI
│   └── 検索結果表示
│
├── 4.2 フォロー/フォロー解除機能
│   ├── フォロー処理API（POST /users/:id/follow）
│   ├── フォロー解除API（DELETE /users/:id/follow）
│   ├── フォロワー一覧API（GET /users/:id/followers）
│   ├── フォロー中一覧API（GET /users/:id/following）
│   └── フロントエンド画面更新
│
├── 4.3 ユーザープロフィール機能
│   ├── プロフィール編集機能
│   ├── プロフィール画像アップロード
│   ├── 自己紹介編集
│   └── プロフィール表示画面の改善
│
└── 4.4 提案機能
    ├── おすすめユーザー表示
    └── 相互フォロー提案

【フェーズ3：メッセージング機能強化（優先度：中）】
┌─────────────────────────────────────────────────────────────────
├── 5.1 メッセージ既読機能
│   ├── 既読状態の管理
│   ├── 既読日時の記録
│   ├── 既読状態の表示（UI）
│   └── 既読状態の通知
│
├── 5.2 メッセージ削除機能
│   ├── メッセージ削除API（DELETE /messages/:id）
│   ├── ローカルファイル削除
│   ├── UIから削除オプション表示
│   └── 削除確認ダイアログ
│
├── 5.3 複数メッセージ管理
│   ├── メッセージをグループ化
│   ├── スレッド機能
│   └── メッセージ検索機能
│
├── 5.4 音声テキスト化（Speech-to-Text）
│   ├── Google Cloud Speech-to-Text API連携
│   ├── バックエンド処理
│   ├── テキスト保存
│   └── メッセージに表示
│
└── 5.5 メッセージ通知機能
    ├── Firebase Cloud Messaging（FCM）導入
    ├── プッシュ通知送信
    ├── 通知設定画面
    └── バックグラウンド処理

【フェーズ4：高度な機能（優先度：中）】
┌─────────────────────────────────────────────────────────────────
├── 6.1 音声フィルター・エフェクト
│   ├── 音量調整
│   ├── 再生速度変更
│   ├── エコー/リバーブエフェクト
│   └── ボイスチェンジャー機能
│
├── 6.2 グループメッセージング
│   ├── グループ作成機能
│   ├── グループ内メッセージ送受信
│   ├── グループメンバー管理
│   └── グループプロフィール
│
├── 6.3 リアクション機能
│   ├── メッセージへのリアクション（絵文字など）
│   ├── リアクション一覧表示
│   ├── リアクション削除機能
│   └── リアクション通知
│
├── 6.4 録音品質設定
│   ├── ビットレート選択
│   ├── サンプリングレート設定
│   ├── 音声フォーマット選択
│   └── ファイルサイズ表示
│
└── 6.5 オフラインモード
    ├── ローカルメッセージ保存
    ├── 接続復帰時の同期
    └── オフライン表示機能

【フェーズ5：セキュリティ・パフォーマンス（優先度：中）】
┌─────────────────────────────────────────────────────────────────
├── 7.1 エンドツーエンド暗号化
│   ├── TweetNaCl.js導入
│   ├── メッセージ暗号化
│   ├── ファイル暗号化
│   └── 鍵管理
│
├── 7.2 キャッシング戦略
│   ├── ローカルデータキャッシュ
│   ├── 画像キャッシング
│   └── APIレスポンスキャッシング
│
├── 7.3 パフォーマンス最適化
│   ├── ファイル圧縮
│   ├── バッチダウンロード
│   ├── ページング実装
│   └── 遅延ローディング
│
├── 7.4 エラーハンドリング強化
│   ├── ネットワークエラーハンドリング
│   ├── タイムアウト処理
│   ├── リトライロジック
│   └── ユーザーフレンドリーなエラーメッセージ
│
└── 7.5 ログとモニタリング
    ├── Sentry導入
    ├── エラーログ収集
    ├── パフォーマンスモニタリング
    └── ユーザー行動分析

【フェーズ6：UI/UX改善（優先度：低）】
┌─────────────────────────────────────────────────────────────────
├── 8.1 テーマカスタマイズ
│   ├── ダークモード対応
│   ├── ライトモード対応
│   ├── カスタムカラーテーマ
│   └── テーマ切り替え機能
│
├── 8.2 アニメーション強化
│   ├── ページ遷移アニメーション
│   ├── ローディングアニメーション
│   ├── メッセージ表示アニメーション
│   └── ボタンインタラクション
│
├── 8.3 インターナショナライゼーション（i18n）
│   ├── 多言語対応（日本語、英語など）
│   ├── 地域別フォーマット対応
│   └── 言語切り替え機能
│
├── 8.4 アクセシビリティ改善
│   ├── スクリーンリーダー対応
│   ├── 大文字表示対応
│   ├── 高コントラストモード
│   └── タッチターゲット拡大
│
└── 8.5 レスポンシブデザイン
    ├── タブレット対応
    ├── 横画面対応
    ├── 大画面スマートフォン対応
    └── 折り畳みスマートフォン対応

【フェーズ7：テスト・デプロイメント（優先度：高）】
┌─────────────────────────────────────────────────────────────────
├── 9.1 ユニットテスト
│   ├── audio_service.dart テスト
│   ├── api_service.dart テスト
│   ├── バックエンド API テスト
│   └── 目標カバレッジ：80%以上
│
├── 9.2 ウィジェットテスト
│   ├── UI コンポーネントテスト
│   ├── 画面遷移テスト
│   └── ユーザーインタラクションテスト
│
├── 9.3 統合テスト
│   ├── エンドツーエンドテスト
│   ├── API 統合テスト
│   └── データベース統合テスト
│
├── 9.4 バックエンドテスト
│   ├── Jest設定
│   ├── API エンドポイントテスト
│   ├── ミドルウェアテスト
│   └── エラーハンドリングテスト
│
└── 9.5 デプロイメント
    ├── Docker コンテナ化
    ├── CI/CD パイプライン構築
    ├── AWS/Google Cloud デプロイメント
    ├── App Store/Google Play リリース
    └── バージョン管理とロールバック


================================================================================
4. 開発優先順位（推奨される実装順序）
================================================================================

1位：フェーズ1（データベース＆ユーザー認証）
   └─ 理由：すべての機能の基盤となるため

2位：フェーズ2（フォロワー機能強化）
   └─ 理由：ユーザー認証の後に必須

3位：フェーズ3（メッセージング機能強化）
   └─ 理由：コア機能の完成度向上

4位：フェーズ7（テスト・デプロイメント）
   └─ 理由：本番環境リリースに必要

5位：フェーズ4（高度な機能）
   └─ 理由：差別化機能の追加

6位：フェーズ5（セキュリティ・パフォーマンス）
   └─ 理由：ユーザー増加時に重要化

7位：フェーズ6（UI/UX改善）
   └─ 理由：機能完成後の改善


================================================================================
5. 技術スタック
================================================================================

【フロントエンド】
- Framework: Flutter 3.9.2+
- Language: Dart
- State Management: (Provider/Riverpod 推奨)
- UI Components: Material Design
- Audio: record, audioplayers, flutter_sound
- Networking: http, dio (推奨)
- Authentication: firebase_auth (推奨)
- Local Storage: shared_preferences, hive
- Image Handling: image_picker, cached_network_image

【バックエンド】
- Runtime: Node.js 18+
- Framework: Express.js 4.18+
- Database: MongoDB/PostgreSQL (推奨)
- ORM: Mongoose/TypeORM
- Authentication: jsonwebtoken, bcrypt
- File Upload: multer
- API Documentation: Swagger/OpenAPI
- Testing: Jest, Supertest
- Deployment: Docker, AWS/Google Cloud

【DevOps】
- Version Control: Git/GitHub
- CI/CD: GitHub Actions
- Container: Docker
- Cloud: AWS/Google Cloud Platform
- Monitoring: Sentry, Datadog
- Logging: Winston, Morgan


================================================================================
6. 実装予定のAPI一覧
================================================================================

【認証API】
POST   /auth/register          - ユーザー登録
POST   /auth/login             - ログイン
POST   /auth/logout            - ログアウト
POST   /auth/refresh           - トークンリフレッシュ
POST   /auth/reset-password    - パスワードリセット

【ユーザーAPI】
GET    /users                  - ユーザー一覧
GET    /users/search           - ユーザー検索
GET    /users/:id              - ユーザー詳細
PUT    /users/:id              - プロフィール更新
DELETE /users/:id              - アカウント削除
GET    /users/:id/followers    - フォロワー一覧
GET    /users/:id/following    - フォロー中一覧

【フォロー関連API】
POST   /users/:id/follow       - フォロー
DELETE /users/:id/follow       - フォロー解除
GET    /users/:id/suggestions  - 提案ユーザー

【メッセージAPI】
POST   /messages                - メッセージ送信
GET    /messages                - メッセージ一覧
GET    /messages/:id            - メッセージ詳細
DELETE /messages/:id            - メッセージ削除
PUT    /messages/:id/read       - 既読マーク
GET    /messages/search         - メッセージ検索

【ファイルAPI】
POST   /upload                  - ファイルアップロード
GET    /voices                  - ファイル一覧
GET    /voice/:filename         - ファイルダウンロード
DELETE /voice/:filename         - ファイル削除
POST   /voice/:id/transcribe    - 音声テキスト化

【通知API】
POST   /notifications           - 通知送信
GET    /notifications           - 通知一覧
DELETE /notifications/:id       - 通知削除


================================================================================
7. 今後の考慮事項
================================================================================

【スケーラビリティ】
- マイクロサービスアーキテクチャへの移行検討
- メッセージキューシステム（RabbitMQ, Redis）導入
- CDN統合（Cloudflare, AWS CloudFront）
- データベースレプリケーション

【セキュリティ】
- HTTPS/TLS通信の強制
- CORS設定の最適化
- レート制限の実装
- DDoS対策

【ユーザー体験】
- オフライン同期機能
- バックグラウンド処理
- プッシュ通知
- リアルタイム通知（WebSocket/Socket.io）

【拡張機能】
- Webバージョンの開発
- デスクトップアプリ（Electron）
- スマートウォッチ対応
- AI による音声要約・翻訳


================================================================================
8. 更新履歴
================================================================================

2026-02-03: 初版作成
  - プロジェクト構成の整理
  - 現在実装機能の記録
  - 7フェーズの実装ロードマップ作成
  - API一覧の作成


================================================================================
