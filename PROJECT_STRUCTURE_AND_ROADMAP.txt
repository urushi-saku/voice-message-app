================================================================================
ボイスメッセージ送受信アプリ
プロジェクト構成と実装ロードマップ
================================================================================

更新日: 2026年2月15日
プロジェクト根: /home/xiaox/voice-message-app

【最新状況】
フェーズ1（データベース連携＆認証）: 完了 ✅
フェーズ2（フォロワー機能強化）: 完了 ✅
フェーズ3（メッセージング機能強化）: 完了 ✅
フェーズ4（オフラインモード実装）: 完了 ✅
フェーズ4（プロフィール機能強化）: 完了 ✅
フェーズ4（録音品質設定）: 完了 ✅
フェーズ5-7: 未着手


================================================================================
1. 現在のファイル構成
================================================================================

voice-message-app/
├── README.md                          # プロジェクト概要と実装機能説明
├── backend/                            # Node.js Expressバックエンド
│   ├── app.js                         # メインサーバーファイル
│   │   ├── MongoDB Atlas接続
│   │   ├── ルーティング設定（/auth, /users, /messages）
│   │   └── CORS設定
│   ├── package.json                   # NPM設定
│   ├── models/                        # Mongooseモデル
│   │   ├── User.js                   # ユーザーモデル
│   │   ├── Follower.js               # フォロー関係モデル
│   │   └── Message.js                # メッセージモデル
│   ├── controllers/                   # ビジネスロジック
│   │   ├── authController.js         # 認証処理
│   │   ├── userController.js         # ユーザー管理 ✅
│   │   │   ├── searchUsers           # ユーザー検索
│   │   │   ├── followUser            # フォロー
│   │   │   ├── unfollowUser          # フォロー解除
│   │   │   ├── getFollowers          # フォロワー一覧
│   │   │   ├── getFollowing          # フォロー中一覧
│   │   │   ├── getUserById           # ユーザー詳細取得
│   │   │   ├── updateProfile         # プロフィール更新 ✅
│   │   │   └── updateProfileImage    # プロフィール画像更新 ✅
│   │   └── messageController.js      # メッセージ処理
│   ├── routes/                        # APIルーティング
│   │   ├── auth.js                   # 認証API
│   │   ├── user.js                   # ユーザーAPI ✅
│   │   │   ├── GET /users/search     # ユーザー検索
│   │   │   ├── PUT /users/profile    # プロフィール更新 ✅
│   │   │   ├── PUT /users/profile/image # プロフィール画像更新 ✅
│   │   │   ├── GET /users/:id        # ユーザー詳細
│   │   │   ├── POST /users/:id/follow # フォロー
│   │   │   ├── DELETE /users/:id/follow # フォロー解除
│   │   │   ├── GET /users/:id/followers # フォロワー一覧
│   │   │   └── GET /users/:id/following # フォロー中一覧
│   │   └── message.js                # メッセージAPI
│   ├── middleware/                    # ミドルウェア
│   │   └── authMiddleware.js         # JWT認証
│   └── uploads/                       # ファイル保存ディレクトリ
│       ├── *.m4a                     # 音声ファイル
│       └── profiles/                 # プロフィール画像 ✅
│           └── *.jpg, *.png          # 画像ファイル
│
└── voice_message_app/                 # Flutterモバイルアプリ
    ├── pubspec.yaml                   # Flutter依存パッケージ
    │   ├── record: ^5.1.2            # 音声録音
    │   ├── audioplayers: ^6.0.0      # 音声再生
    │   ├── permission_handler: ^11.3.1 # 権限管理
    │   ├── http: ^1.2.1              # HTTP通信
    │   ├── path_provider: ^2.1.3     # ファイルパス取得
    │   ├── image_picker: ^1.0.7      # 画像選択
    │   ├── provider: ^6.1.5          # 状態管理
    │   ├── shared_preferences: ^2.2.2 # ローカルストレージ
    │   └── timeago: ^3.6.1           # 相対時間表示
    │
    ├── lib/                           # アプリケーションコード
    │   ├── main.dart                  # アプリエントリーポイント
    │   │   ├── MyApp: メインウィジェット
    │   │   └── テーマ設定（deepPurple）
    │   │
    │   ├── constants.dart             # 定数定義
    │   │
    │   ├── screens/                   # UI画面
    │   │   ├── home_page.dart        # ホーム画面（タブナビゲーション） ✅
    │   │   │   ├── ボイスメッセージタブ
    │   │   │   ├── フォロワータブ
    │   │   │   ├── 受信ファイルタブ
    │   │   │   └── プロフィールタブ
    │   │   │
    │   │   ├── login_screen.dart     # ログイン画面 ✅
    │   │   │   ├── JWT認証
    │   │   │   └── トークン保存
    │   │   │
    │   │   ├── register_screen.dart  # 登録画面 ✅
    │   │   │   └── ユーザー登録処理
    │   │   │
    │   │   ├── recording_screen.dart # 録音画面 ✅
    │   │   │   ├── 音声録音UI
    │   │   │   ├── MessageService統合
    │   │   │   ├── 複数受信者への送信
    │   │   │   └── 録音品質表示 ✅
    │   │   │
    │   │   ├── select_follower_screen.dart # フォロワー選択画面 ✅
    │   │   │   ├── API連携フォロー一覧
    │   │   │   ├── 複数選択機能
    │   │   │   └── 受信者ID渡し
    │   │   │
    │   │   ├── followers_tab.dart   # フォロワー一覧タブ ✅
    │   │   │   ├── Followers/Followingタブ
    │   │   │   ├── ユーザー検索機能
    │   │   │   ├── フォロー/アンフォローボタン
    │   │   │   └── プルダウン更新
    │   │   │
    │   │   ├── received_files_tab.dart # 受信メッセージタブ ✅
    │   │   │   ├── MessageInfo一覧表示
    │   │   │   ├── 既読/未読管理
    │   │   │   ├── timeago時間表示
    │   │   │   ├── スワイプ削除
    │   │   │   └── 既読マーク機能
    │   │   │
    │   │   ├── voice_playback_screen.dart # 音声再生画面 ✅
    │   │   │   ├── ファイルダウンロード
    │   │   │   ├── ローカル再生
    │   │   │   ├── ローディング/エラー表示
    │   │   │   └── 送信者情報表示
    │   │   │
    │   │   ├── profile_page.dart    # プロフィール画面 ✅
    │   │   │   ├── ユーザー情報表示
    │   │   │   ├── ログアウト機能
    │   │   │   ├── 編集ボタン ✅
    │   │   │   └── 設定ボタン ✅
    │   │   │
    │   │   ├── edit_profile_screen.dart # プロフィール編集画面 ✅
    │   │   │   ├── ユーザー名編集
    │   │   │   ├── 自己紹介編集
    │   │   │   ├── プロフィール画像選択
    │   │   │   ├── 画像プレビュー
    │   │   │   └── 保存機能
    │   │   │
    │   │   └── settings_screen.dart # 設定画面 ✅
    │   │       ├── 録音品質選択
    │   │       ├── 品質説明表示
    │   │       └── 設定保存
    │   │
    │   ├── services/                 # ビジネスロジック層 ✅
    │   │   ├── audio_service.dart    # 音声録音・再生管理 ✅
    │   │   │   ├── startRecording()   # 録音開始
    │   │   │   ├── stopRecording()    # 録音停止
    │   │   │   ├── setQuality()       # 録音品質設定 ✅
    │   │   │   ├── playAudio()        # 音声再生
    │   │   │   ├── pausePlayback()    # 再生一時停止
    │   │   │   └── dispose()          # リソース解放
    │   │   │
    │   │   ├── auth_service.dart     # 認証サービス ✅
    │   │   │   ├── register()         # ユーザー登録
    │   │   │   ├── login()            # ログイン
    │   │   │   ├── getToken()         # トークン取得
    │   │   │   ├── saveToken()        # トークン保存
    │   │   │   ├── logout()           # ログアウト
    │   │   │   └── getMe()            # 現在のユーザー情報取得
    │   │   │
    │   │   ├── user_service.dart     # ユーザー管理サービス ✅
    │   │   │   ├── UserInfoクラス
    │   │   │   ├── searchUsers()      # ユーザー検索
    │   │   │   ├── getUserById()      # ユーザー詳細
    │   │   │   ├── followUser()       # フォロー
    │   │   │   ├── unfollowUser()     # アンフォロー
    │   │   │   ├── getFollowers()     # フォロワー一覧
    │   │   │   ├── getFollowing()     # フォロー中一覧
    │   │   │   ├── updateProfile()    # プロフィール更新 ✅
    │   │   │   └── updateProfileImage() # プロフィール画像更新 ✅
    │   │   │
    │   │   ├── message_service.dart  # メッセージサービス ✅
    │   │   │   ├── MessageInfoクラス
    │   │   │   ├── sendMessage()      # メッセージ送信（オフライン対応）
    │   │   │   ├── getReceivedMessages() # 受信一覧（キャッシュ対応）
    │   │   │   ├── getSentMessages()  # 送信一覧
    │   │   │   ├── markAsRead()       # 既読マーク
    │   │   │   ├── deleteMessage()    # メッセージ削除
    │   │   │   └── downloadMessage()  # ファイルダウンロード
    │   │   │
    │   │   ├── offline_service.dart  # オフラインストレージ管理 ✅
    │   │   │   ├── Hive初期化
    │   │   │   ├── オフラインメッセージ管理
    │   │   │   ├── ユーザー情報キャッシュ
    │   │   │   ├── メッセージキャッシュ
    │   │   │   ├── フォロー情報キャッシュ
    │   │   │   └── ストレージ管理
    │   │   │
    │   │   ├── network_connectivity_service.dart # ネットワーク監視 ✅
    │   │   │   ├── 接続状態監視
    │   │   │   ├── オンライン/オフライン検出
    │   │   │   ├── 接続変更コールバック
    │   │   │   └── Provider統合
    │   │   │
    │   │   ├── sync_service.dart     # データ同期サービス ✅
    │   │   │   ├── オフラインメッセージ同期
    │   │   │   ├── 自動同期処理
    │   │   │   ├── キャッシュ更新
    │   │   │   └── 同期統計管理
    │   │   │
    │   │   └── api_service.dart      # サーバー通信管理（旧バージョン）
    │   │
    │   ├── models/                   # データモデル ✅
    │   │   ├── offline_model.dart    # オフラインデータモデル
    │   │   │   ├── OfflineMessage      # 送信待機メッセージ
    │   │   │   ├── CachedUserInfo      # ユーザーキャッシュ
    │   │   │   ├── CachedMessageInfo   # メッセージキャッシュ
    │   │   │   ├── CachedFollowInfo    # フォローキャッシュ
    │   │   │   ├── OfflineConfig       # オフライン設定
    │   │   │   ├── SyncStatistics      # 同期統計
    │   │   │   └── SyncStatus          # 同期状態
    │   │   │
    │   │   └── recording_config.dart # 録音設定モデル ✅
    │   │       ├── RecordingQuality    # 録音品質列挙型
    │   │       ├── RecordingConfig     # 録音設定クラス
    │   │       └── 品質プリセット（低・中・高）
    │   │
    │   ├── widgets/                  # 共通ウィジェット ✅
    │   │   └── offline_banner.dart   # オフラインバナー
    │   │       ├── OfflineBanner       # オフライン状態表示
    │   │       ├── NetworkStatusIndicator # ネットワーク状態
    │   │       └── OfflineInfoBottomSheet # 詳細情報
    │   │
    │   └── providers/                # 状態管理 ✅
    │       └── auth_provider.dart    # 認証状態管理
    │
    ├── test/                         # テストコード
    │   └── widget_test.dart          # ウィジェットテスト
    │
    ├── android/                      # Android設定ファイル
    ├── ios/                          # iOS設定ファイル
    ├── linux/                        # Linux設定ファイル
    ├── macos/                        # macOS設定ファイル
    ├── web/                          # Web設定ファイル
    └── windows/                      # Windows設定ファイル


================================================================================
2. 現在実装されている機能
================================================================================

【フロントエンド：Flutter】
✅ 基本的なUIフレームワーク（タブナビゲーション）
✅ 音声録音機能（マイク権限管理含む）
✅ 音声再生機能
✅ 録音品質設定（低・中・高） ✅
✅ ユーザー認証（ログイン/登録）
✅ JWT トークン管理
✅ 認証状態管理（Provider）
✅ ユーザー検索機能
✅ フォロー/アンフォロー機能
✅ フォロワー/フォロー中一覧表示
✅ 複数フォロワー選択UI
✅ 音声メッセージ送信（複数受信者）
✅ 受信メッセージ一覧表示
✅ 既読/未読管理
✅ メッセージ削除機能（スワイプ）
✅ 相対時間表示（timeago）
✅ ファイルダウンロード＆ローカル再生
✅ プロフィール画面
✅ プロフィール編集機能 ✅
  ├── ✅ ユーザー名編集
  ├── ✅ 自己紹介編集
  ├── ✅ プロフィール画像選択・アップロード
  └── ✅ リアルタイムプレビュー
✅ 設定画面 ✅
  └── ✅ 録音品質選択
✅ ログアウト機能
✅ リアルタイム再生時間表示
✅ ローディング/エラー状態管理
✅ オフラインモード対応
  ├── ✅ Hiveローカルストレージ
  ├── ✅ ネットワーク接続状態監視
  ├── ✅ オフライン時メッセージ保存
  ├── ✅ オンライン復帰時自動同期
  ├── ✅ メッセージ・ユーザー情報キャッシング
  ├── ✅ オフライン状態UIバナー表示
  └── ✅ 同期統計情報管理

【バックエンド：Node.js Express + MongoDB】
✅ MongoDB Atlas接続
✅ ユーザー認証API（登録/ログイン/ログアウト）
✅ JWT トークン認証
✅ bcrypt パスワード暗号化
✅ ユーザー検索API（GET /users/search）
✅ プロフィール更新API（PUT /users/profile） ✅
✅ プロフィール画像更新API（PUT /users/profile/image） ✅
✅ フォロー/アンフォローAPI（POST/DELETE /users/:id/follow）
✅ フォロワー/フォロー中一覧API（GET /users/:id/followers, /users/:id/following）
✅ メッセージ送信API（POST /messages/send）
✅ メッセージ受信一覧API（GET /messages/received）
✅ メッセージ送信一覧API（GET /messages/sent）
✅ 既読マークAPI（PUT /messages/:id/read）
✅ メッセージ削除API（DELETE /messages/:id）
✅ ファイルダウンロードAPI（GET /messages/:id/download）
✅ Multerを使用したファイルアップロード
  ├── ✅ 音声ファイル（最大10MB）
  └── ✅ プロフィール画像（最大5MB） ✅
✅ 認証ミドルウェア（protect）
✅ エラーハンドリング
✅ CORS設定

【データベース：MongoDB】
✅ User モデル（username, email, password, profileImage, bio, フォロワー数）
✅ Follower モデル（user, follower, followedAt）
✅ Message モデル（sender, receivers, filePath, duration, readStatus, sentAt）


================================================================================
3. 今後の実装予定内容
================================================================================

【フェーズ1：データベース連携（優先度：高）】✅ 完了
┌─────────────────────────────────────────────────────────────────
├── 3.1 ユーザー認証機能 ✅
│   ├── ✅ ユーザー登録API
│   ├── ✅ ログイン機能
│   ├── ✅ JWTトークン認証
│   ├── ✅ パスワード暗号化（bcrypt）
│   └── ✅ トークン管理（shared_preferences）
│
├── 3.2 データベース設計・実装 ✅
│   ├── ✅ MongoDB Atlas導入
│   ├── ✅ Userモデル
│   │   ├── username（ユニーク）
│   │   ├── email（ユニーク）
│   │   ├── password（ハッシュ化）
│   │   ├── profileImage
│   │   ├── bio
│   │   ├── followersCount
│   │   └── followingCount
│   │
│   ├── ✅ Followerモデル
│   │   ├── user（参照）
│   │   ├── follower（参照）
│   │   ├── followedAt
│   │   └── 複合インデックス（user + follower）
│   │
│   └── ✅ Messageモデル
│       ├── sender（参照）
│       ├── receivers（配列、参照）
│       ├── filePath
│       ├── fileSize
│       ├── duration
│       ├── mimeType
│       ├── readStatus（配列：user, isRead, readAt）
│       ├── sentAt
│       └── isDeleted（論理削除）
│
├── 3.3 フロントエンド：認証画面の実装 ✅
│   ├── ✅ ログイン画面
│   ├── ✅ 登録画面
│   ├── ✅ 認証状態の管理（Provider）
│   └── ⏳ パスワードリセット画面（未実装）
│
└── 3.4 バックエンド：認証APIの実装 ✅
    ├── ✅ POST /auth/register - ユーザー登録
    ├── ✅ POST /auth/login - ログイン
    ├── ✅ GET /auth/me - ユーザー情報取得
    └── ⏳ POST /auth/refresh - トークンリフレッシュ（未実装）

【フェーズ2：フォロワー機能強化（優先度：高）】✅ 完了
┌─────────────────────────────────────────────────────────────────
├── 4.1 ユーザー検索機能 ✅
│   ├── ✅ ユーザー検索API（GET /users/search）
│   ├── ✅ フロントエンド検索UI（UserSearchScreen）
│   ├── ✅ デバウンス機能（500ms）
│   └── ✅ 検索結果表示
│
├── 4.2 フォロー/フォロー解除機能 ✅
│   ├── ✅ フォロー処理API（POST /users/:id/follow）
│   ├── ✅ フォロー解除API（DELETE /users/:id/follow）
│   ├── ✅ フォロワー一覧API（GET /users/:id/followers）
│   ├── ✅ フォロー中一覧API（GET /users/:id/following）
│   ├── ✅ フロントエンド画面更新（followers_tab.dart）
│   ├── ✅ 自動フォロワー数カウント更新
│   └── ✅ 重複フォロー防止
│
├── 4.3 ユーザープロフィール機能 ⏳ 部分実装
│   ├── ✅ プロフィール表示画面
│   ├── ⏳ プロフィール編集機能（未実装）
│   ├── ⏳ プロフィール画像アップロード（未実装）
│   └── ⏳ 自己紹介編集（未実装）
│
└── 4.4 提案機能 ⏳ 未実装
    ├── ⏳ おすすめユーザー表示
    └── ⏳ 相互フォロー提案

【フェーズ3：メッセージング機能強化（優先度：中）】✅ 完了
┌─────────────────────────────────────────────────────────────────
├── 5.1 メッセージ既読機能 ✅
│   ├── ✅ 既読状態の管理（readStatus配列）
│   ├── ✅ 既読日時の記録
│   ├── ✅ 既読状態の表示（UI）
│   ├── ✅ 既読マークAPI（PUT /messages/:id/read）
│   ├── ✅ 再生時自動既読マーク
│   └── ⏳ 既読通知（未実装）
│
├── 5.2 メッセージ削除機能 ✅
│   ├── ✅ メッセージ削除API（DELETE /messages/:id）
│   ├── ✅ 論理削除（isDeletedフラグ）
│   ├── ✅ スワイプで削除UI
│   ├── ✅ 削除確認ダイアログ
│   ├── ✅ ローカルファイル物理削除（フロントエンド）
│   └── ✅ サーバーファイル物理削除（全ユーザー削除時）
│
├── 5.3 複数メッセージ管理 ✅ 完了
│   ├── ✅ メッセージ一覧表示
│   ├── ✅ 送信者別表示
│   ├── ✅ 時間順ソート
│   ├── ✅ メッセージ検索機能（送信者名検索）
│   ├── ✅ 既読/未読フィルター
│   ├── ✅ 日付範囲フィルター
│   ├── ✅ メッセージグループ化（送信者別スレッド表示）
│   ├── ✅ スレッド機能（スレッド一覧・詳細画面）
│   └── ✅ リスト表示・カード表示の切り替え
│
└── 5.4 メッセージ通知機能（Firebase Cloud Messaging） ⏳ 部分実装
    ├── ✅ FCMサービス実装（firebase_messagingパッケージ統合）
    │   ├── ✅ 通知受信リスナー設定
    │   ├── ✅ バックグラウンド通知ハンドラー
    │   └── ✅ トークン管理（更新・削除）
    ├── ✅ Firebase Admin SDK設定コード
    │   ├── ✅ serviceAccountKey.jsonテンプレート
    │   ├── ✅ Firebase初期化ロジック
    │   └── ✅ FCM通知送信関数
    ├── ⏳ Firebase秘密鍵設定（ユーザー手動設定）
    │   ├── ✅ セットアップドキュメント作成（FIREBASE_BACKEND_SETUP.md）
    │   ├── ✅ .env.example にFCM設定追加
    │   ├── ✅ .gitignore に serviceAccountKey.json 追加
    │   ├── ✅ firebase_options.dart テンプレート生成
    │   └── ⏳ 実際のserviceAccountKey.json配置（ユーザー・Firebase Console）
    ├── ✅ バックエンドAPI実装
    │   ├── ✅ PUT /auth/fcm-token - FCMトークン更新
    │   ├── ✅ User モデルにfcmTokenフィールド
    │   └── ✅ メッセージ送信時の通知送信ロジック
    ├── ✅ フロントエンド実装
    │   ├── ✅ fcm_service.dart - FCM通知管理
    │   ├── ✅ Firebase初期化（main.dart）
    │   └── ✅ ログイン時のFCMトークン送信
    └── ⏳ 通知タップ時の画面遷移処理

【フェーズ4：高度な機能（優先度：中）】✅ 完了（オフラインモード）
┌─────────────────────────────────────────────────────────────────
├── 6.0 オフラインモード ✅ 完了
│   ├── ✅ Hive + hive_flutter パッケージ導入
│   ├── ✅ connectivity_plus パッケージ導入
│   ├── ✅ uuid パッケージ導入
│   ├── ✅ オフラインデータモデル作成（offline_model.dart）
│   │   ├── OfflineMessage - 送信待機メッセージ
│   │   ├── CachedUserInfo - ユーザー情報キャッシュ
│   │   ├── CachedMessageInfo - メッセージ情報キャッシュ
│   │   ├── CachedFollowInfo - フォロー情報キャッシュ
│   │   ├── OfflineConfig - オフラインモード設定
│   │   ├── SyncStatistics - 同期統計情報
│   │   └── SyncStatus - 同期状態列挙型
│   │
│   ├── ✅ OfflineService実装（offline_service.dart）
│   │   ├── Hive初期化処理
│   │   ├── オフラインメッセージ管理
│   │   ├── ユーザー情報キャッシュ管理
│   │   ├── メッセージキャッシュ管理
│   │   ├── フォロー情報キャッシュ管理
│   │   ├── オフライン設定管理
│   │   ├── 同期統計情報管理
│   │   └── キャッシュクリーンアップ
│   │
│   ├── ✅ NetworkConnectivityService実装（network_connectivity_service.dart）
│   │   ├── ネットワーク接続状態監視
│   │   ├── オンライン/オフライン検出
│   │   ├── 接続状態変更コールバック
│   │   ├── 接続詳細情報取得
│   │   └── Provider統合
│   │
│   ├── ✅ SyncService実装（sync_service.dart）
│   │   ├── オフラインメッセージ同期
│   │   ├── ネットワーク復帰時自動同期
│   │   ├── 失敗メッセージ再同期
│   │   ├── キャッシュ更新処理
│   │   ├── 同期統計管理
│   │   └── Provider統合
│   │
│   ├── ✅ MessageService統合
│   │   ├── オフライン時メッセージローカル保存
│   │   ├── オンライン時サーバー送信
│   │   ├── タイムアウト処理
│   │   ├── ネットワークエラー処理
│   │   ├── 受信メッセージキャッシング
│   │   └── オフライン時キャッシュから読み込み
│   │
│   ├── ✅ UIコンポーネント実装
│   │   ├── OfflineBanner - オフライン状態バナー
│   │   ├── NetworkStatusIndicator - ネットワーク状態表示
│   │   ├── OfflineInfoBottomSheet - オフライン詳細情報
│   │   └── 受信メッセージ画面への統合
│   │
│   ├── ✅ main.dart初期化処理
│   │   ├── OfflineService.initialize()
│   │   ├── NetworkConnectivityService.initialize()
│   │   ├── Provider設定追加
│   │   └── エラーハンドリング
│   │
│   └── ⏳ ビルド＆テスト
│       ├── ⏳ build_runner実行（Hiveアダプター生成）
│       ├── ⏳ オフライン送信テスト
│       ├── ⏳ ネットワーク復帰時同期テスト
│       ├── ⏳ キャッシュ読み込みテスト
│       └── ⏳ UI表示テスト
│
├── 6.1 プロフィール機能強化 ✅ 完了
│   ├── ✅ プロフィール編集機能
│   │   ├── ユーザー名編集
│   │   ├── 自己紹介編集
│   │   └── バリデーション機能
│   ├── ✅ プロフィール画像アップロード
│   │   ├── 画像選択（ギャラリーから）
│   │   ├── 画像プレビュー
│   │   ├── 画像圧縮（最大1024x1024、85%品質）
│   │   └── サーバーへのアップロード
│   ├── ✅ プロフィール表示の強化
│   │   ├── プロフィール画像表示
│   │   ├── フォロー情報表示
│   │   └── 編集/設定ボタン追加
│   └── ✅ バックエンドAPI実装
│       ├── PUT /users/profile - プロフィール更新
│       ├── PUT /users/profile/image - プロフィール画像更新
│       └── 画像ファイル管理（uploads/profiles/）
│
├── 6.2 音声フィルター・エフェクト ✅ 完了
│   ├── ✅ 音量調整（0%〜200%スライダー）
│   ├── ✅ 再生速度変更（0.5x〜2.0xプリセット+スライダー）
│   ├── ✅ エコー/リバーブエフェクト（ON/OFF + 強度調整）
│   └── ✅ ボイスチェンジャー機能（ノーマル/高い声/低い声/ロボット/チップマンク）
│
├── 6.3 グループメッセージング ⏳ 未実装
│   ├── グループ作成機能
│   ├── グループ内メッセージ送受信
│   ├── グループメンバー管理
│   └── グループプロフィール
│
├── 6.4 リアクション機能 ⏳ 未実装
│   ├── メッセージへのリアクション（絵文字など）
│   ├── リアクション一覧表示
│   ├── リアクション削除機能
│   └── リアクション通知
│
└── 6.5 録音品質設定 ✅ 完了
    ├── ✅ 録音品質モデル作成（recording_config.dart）
    │   ├── 低品質（16kHz、32kbps）
    │   ├── 中品質（22.05kHz、64kbps）- デフォルト
    │   └── 高品質（44.1kHz、128kbps）
    ├── ✅ AudioServiceへの統合
    │   ├── 品質設定の適用
    │   └── RecordConfig設定
    ├── ✅ 設定画面UI実装（settings_screen.dart）
    │   ├── 品質選択ラジオボタン
    │   ├── 品質説明表示
    │   ├── 推定ファイルサイズ表示
    │   └── SharedPreferencesへの保存
    └── ✅ RecordingScreen統合
        ├── 品質設定の読み込み
        └── 現在の品質表示

【フェーズ5：セキュリティ・パフォーマンス（優先度：中）】
┌─────────────────────────────────────────────────────────────────
├── 7.1 エンドツーエンド暗号化
│   ├── TweetNaCl.js導入
│   ├── メッセージ暗号化
│   ├── ファイル暗号化
│   └── 鍵管理
│
├── 7.2 キャッシング戦略
│   ├── ローカルデータキャッシュ
│   ├── 画像キャッシング
│   └── APIレスポンスキャッシング
│
├── 7.3 パフォーマンス最適化
│   ├── ファイル圧縮
│   ├── バッチダウンロード
│   ├── ページング実装
│   └── 遅延ローディング
│
├── 7.4 エラーハンドリング強化
│   ├── ネットワークエラーハンドリング
│   ├── タイムアウト処理
│   ├── リトライロジック
│   └── ユーザーフレンドリーなエラーメッセージ
│
└── 7.5 ログとモニタリング
    ├── Sentry導入
    ├── エラーログ収集
    ├── パフォーマンスモニタリング
    └── ユーザー行動分析

【フェーズ6：UI/UX改善（優先度：低）】
┌─────────────────────────────────────────────────────────────────
├── 8.1 テーマカスタマイズ
│   ├── ダークモード対応
│   ├── ライトモード対応
│   ├── カスタムカラーテーマ
│   └── テーマ切り替え機能
│
├── 8.2 アニメーション強化
│   ├── ページ遷移アニメーション
│   ├── ローディングアニメーション
│   ├── メッセージ表示アニメーション
│   └── ボタンインタラクション
│
├── 8.3 インターナショナライゼーション（i18n）
│   ├── 多言語対応（日本語、英語など）
│   ├── 地域別フォーマット対応
│   └── 言語切り替え機能
│
├── 8.4 アクセシビリティ改善
│   ├── スクリーンリーダー対応
│   ├── 大文字表示対応
│   ├── 高コントラストモード
│   └── タッチターゲット拡大
│
└── 8.5 レスポンシブデザイン
    ├── タブレット対応
    ├── 横画面対応
    ├── 大画面スマートフォン対応
    └── 折り畳みスマートフォン対応

【フェーズ7：テスト・デプロイメント（優先度：高）】
┌─────────────────────────────────────────────────────────────────
├── 9.1 ユニットテスト
│   ├── audio_service.dart テスト
│   ├── api_service.dart テスト
│   ├── バックエンド API テスト
│   └── 目標カバレッジ：80%以上
│
├── 9.2 ウィジェットテスト
│   ├── UI コンポーネントテスト
│   ├── 画面遷移テスト
│   └── ユーザーインタラクションテスト
│
├── 9.3 統合テスト
│   ├── エンドツーエンドテスト
│   ├── API 統合テスト
│   └── データベース統合テスト
│
├── 9.4 バックエンドテスト
│   ├── Jest設定
│   ├── API エンドポイントテスト
│   ├── ミドルウェアテスト
│   └── エラーハンドリングテスト
│
└── 9.5 デプロイメント
    ├── Docker コンテナ化
    ├── CI/CD パイプライン構築
    ├── AWS/Google Cloud デプロイメント
    ├── App Store/Google Play リリース
    └── バージョン管理とロールバック


================================================================================
4. 開発優先順位（推奨される実装順序）
================================================================================

1位：✅ フェーズ1（データベース＆ユーザー認証）
   └─ 状態：完了
   └─ 理由：すべての機能の基盤となるため

2位：✅ フェーズ2（フォロワー機能強化）
   └─ 状態：完了
   └─ 理由：ユーザー認証の後に必須

3位：✅ フェーズ3（メッセージング機能強化）
   └─ 状態：基本機能完了、追加機能は未実装
   └─ 理由：コア機能の完成度向上

4位：⏳ フェーズ7（テスト・デプロイメント）← 【次の優先事項】
   └─ 状態：未着手
   └─ 理由：本番環境リリースに必要

5位：⏳ フェーズ3の残り機能（通知、STT、検索）
   └─ 状態：未実装
   └─ 理由：ユーザー体験の向上

6位：⏳ フェーズ4（高度な機能）
   └─ 状態：未着手
   └─ 理由：差別化機能の追加

7位：⏳ フェーズ5（セキュリティ・パフォーマンス）
   └─ 状態：未着手
   └─ 理由：ユーザー増加時に重要化

8位：⏳ フェーズ6（UI/UX改善）
   └─ 状態：未着手
   └─ 理由：機能完成後の改善


================================================================================
5. 技術スタック
================================================================================

【フロントエンド】
- Framework: Flutter 3.9.2+
- Language: Dart
- State Management: (Provider/Riverpod 推奨)
- UI Components: Material Design
- Audio: record, audioplayers, flutter_sound
- Networking: http, dio (推奨)
- Authentication: firebase_auth (推奨)
- Local Storage: shared_preferences, hive
- Image Handling: image_picker, cached_network_image

【バックエンド】
- Runtime: Node.js 18+
- Framework: Express.js 4.18+
- Database: MongoDB/PostgreSQL (推奨)
- ORM: Mongoose/TypeORM
- Authentication: jsonwebtoken, bcrypt
- File Upload: multer
- API Documentation: Swagger/OpenAPI
- Testing: Jest, Supertest
- Deployment: Docker, AWS/Google Cloud

【DevOps】
- Version Control: Git/GitHub
- CI/CD: GitHub Actions
- Container: Docker
- Cloud: AWS/Google Cloud Platform
- Monitoring: Sentry, Datadog
- Logging: Winston, Morgan


================================================================================
6. 実装予定のAPI一覧
================================================================================

【認証API】
✅ POST   /auth/register          - ユーザー登録
✅ POST   /auth/login             - ログイン
✅ GET    /auth/me                - 現在のユーザー情報
⏳ POST   /auth/logout            - ログアウト（未実装）
⏳ POST   /auth/refresh           - トークンリフレッシュ（未実装）
⏳ POST   /auth/reset-password    - パスワードリセット（未実装）

【ユーザーAPI】
✅ GET    /users/search           - ユーザー検索（クエリパラメータ：q）
✅ GET    /users/:id              - ユーザー詳細
✅ GET    /users/:id/followers    - フォロワー一覧
✅ GET    /users/:id/following    - フォロー中一覧
⏳ GET    /users                  - ユーザー一覧（未実装）
⏳ PUT    /users/:id              - プロフィール更新（未実装）
⏳ DELETE /users/:id              - アカウント削除（未実装）

【フォロー関連API】
✅ POST   /users/:id/follow       - フォロー
✅ DELETE /users/:id/follow       - フォロー解除
⏳ GET    /users/:id/suggestions  - 提案ユーザー（未実装）

【メッセージAPI】
✅ POST   /messages/send          - メッセージ送信（multipart/form-data）
✅ GET    /messages/received      - 受信メッセージ一覧
✅ GET    /messages/sent          - 送信メッセージ一覧
✅ PUT    /messages/:id/read      - 既読マーク
✅ DELETE /messages/:id            - メッセージ削除（論理削除）
✅ GET    /messages/:id/download  - ファイルダウンロード
⏳ GET    /messages/:id            - メッセージ詳細（未実装）
⏳ GET    /messages/search         - メッセージ検索（未実装）
⏳ POST   /messages/:id/transcribe - 音声テキスト化（未実装）

【ファイルAPI（旧バージョン、非推奨）】
⚠️  POST   /upload                  - ファイルアップロード（/messages/sendを使用）
⚠️  GET    /voices                  - ファイル一覧（/messages/*を使用）
⚠️  GET    /voice/:filename         - ファイルダウンロード（/messages/:id/downloadを使用）
⏳ DELETE /voice/:filename         - ファイル削除（未実装）

【通知API】
⏳ POST   /notifications           - 通知送信（未実装）
⏳ GET    /notifications           - 通知一覧（未実装）
⏳ DELETE /notifications/:id       - 通知削除（未実装）


================================================================================
7. 今後の考慮事項
================================================================================

【スケーラビリティ】
- マイクロサービスアーキテクチャへの移行検討
- メッセージキューシステム（RabbitMQ, Redis）導入
- CDN統合（Cloudflare, AWS CloudFront）
- データベースレプリケーション

【セキュリティ】
- HTTPS/TLS通信の強制
- CORS設定の最適化
- レート制限の実装
- DDoS対策

【ユーザー体験】
- オフライン同期機能
- バックグラウンド処理
- プッシュ通知
- リアルタイム通知（WebSocket/Socket.io）

【拡張機能】
- Webバージョンの開発
- デスクトップアプリ（Electron）
- スマートウォッチ対応
- AI による音声要約・翻訳


================================================================================
8. 更新履歴
================================================================================

2026-02-04: 大幅更新（フェーズ1-3完了）
  - フェーズ1（データベース連携＆認証）完了
  - フェーズ2（フォロワー機能強化）完了
  - フェーズ3（メッセージング基本機能）完了
  - 実装済み機能の詳細追記
  - API一覧の実装状況更新
  - バックエンドファイル構成の詳細追加
  - Flutterサービス層の詳細追加
  - 次の優先事項を明確化（テスト・デプロイメント）

2026-02-03: 初版作成
  - プロジェクト構成の整理
  - 現在実装機能の記録
  - 7フェーズの実装ロードマップ作成
  - API一覧の作成


================================================================================
